import React, { useState, useContext, useEffect, useRef } from "react";
import { GameContext } from "../contexts/GameContext";

export default function LandingScreen() {
  const { createGame, joinGame, setScreen } = useContext(GameContext);
  const [playerName, setPlayerName] = useState("");
  const [gameIdInput, setGameIdInput] = useState("");
  const audioRef = useRef(null);
  const [muted, setMuted] = useState(true);

  useEffect(() => {
    // Save original styles
    const originalBgImage = document.body.style.backgroundImage;
    const originalBgColor = document.body.style.backgroundColor;

    // Override for landing screen
    document.body.style.backgroundImage = "none";
    document.body.style.backgroundColor = "#f0f0f0"; // or white

    if (audioRef.current) {
      audioRef.current.volume = 1;
      audioRef.current.muted = true; // Start muted for autoplay
      audioRef.current.play().catch(() => {
        console.log("Autoplay blocked");
      });
    }

    // Cleanup on unmount
    return () => {
      document.body.style.backgroundImage = originalBgImage;
      document.body.style.backgroundColor = originalBgColor;
      if (audioRef.current) {
        audioRef.current.pause();
        audioRef.current.currentTime = 0;
      }
    };
  }, []);

  const handleUnmute = () => {
    if (audioRef.current) {
      audioRef.current.muted = false;
      setMuted(false);
    }
  };

  return (
    <>
      <audio ref={audioRef} src="/music/chill_piano.mp3" loop playsInline muted autoPlay />
      
      <div className="flex flex-col items-center justify-center h-screen bg-gray-100 relative">
        <div className="bg-white rounded-lg shadow-lg p-8 w-full max-w-sm">
          <h1 className="text-3xl font-bold mb-6 text-center">Reactopoly Online</h1>
          {/* ... your inputs and buttons ... */}
        </div>

        {/* Unmute button */}
        {muted && (
          <button
            onClick={handleUnmute}
            className="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow"
            aria-label="Unmute music"
          >
            ðŸ”ˆ Unmute Music
          </button>
        )}

        {/* Attribution footer */}
        <footer className="absolute bottom-2 text-xs text-gray-500 select-none">
          Music:{" "}
          <a
            href="https://www.bensound.com"
            target="_blank"
            rel="noopener noreferrer"
            className="underline"
          >
            bensound.com
          </a>{" "}
          | Artist: Benjamin Tissot | License code: XFG6NZWGCV7XHY9V
        </footer>
      </div>
    </>
  );
}
